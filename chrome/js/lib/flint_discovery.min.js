/*! flint-web-sdk build:0.1.0, production. Copyright(C) 2013-2014 www.OpenFlint.org */!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],d=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}];BrowserDetect=function(){},BrowserDetect.prototype.init=function(){this.browser=this.searchString(c)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(d)||"an unknown OS"},BrowserDetect.prototype.searchString=function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!=c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},BrowserDetect.prototype.searchVersion=function(a){var b=a.indexOf(this.versionSearchString);if(-1!=b){var c=/(?:;|\s|$)/gi;c.lastIndex=b=b+this.versionSearchString.length+1;var d=c.exec(a).index;return a.substring(b,d)}},b.exports=BrowserDetect},{}],2:[function(a,b){var c,d;c=a("./BrowserDetect"),d=function(){function a(){}return a.detector=null,a.getPlatform=function(){var b;return a.detector||(a.detector=new c,a.detector.init(),"firefox"===a.detector.browser.toLowerCase()?void 0!==window.MozActivity&&(a.detector.browser="ffos"):"chrome"===a.detector.browser.toLowerCase()&&void 0!==chrome.sockets&&(a.detector.browser="chrome_app")),b={browser:a.detector.browser.toLowerCase(),version:a.detector.version.toLowerCase(),os:a.detector.OS.toLowerCase()}},a}(),b.exports=d},{"./BrowserDetect":1}],3:[function(a,b){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),d=function(a){function b(){this.timeoutId=null,this.timeout=6e4,this.urlBase=null,this.host=null,this.friendlyName=null,this.uniqueId=null}return f(b,a),b.prototype.getUrlBase=function(){return this.urlBase},b.prototype.getHost=function(){return this.host},b.prototype.getName=function(){return this.friendlyName},b.prototype.getUniqueId=function(){return this.uniqueId},b.prototype.getDeviceType=function(){return null},b.prototype.toJson=function(){var a;return a={deviceName:this.friendlyName,urlBase:this.urlBase,host:this.host,uniqueId:this.uniqueId}},b.prototype.triggerTimer=function(){return this._clearTimer(),this.timeoutId=setTimeout(function(a){return function(){return a._onTimeout()}}(this),this.timeout)},b.prototype.clear=function(){return this._clearTimer()},b.prototype._clearTimer=function(){return this.timeoutId?clearTimeout(this.timeoutId):void 0},b.prototype._onTimeout=function(){return this.emit("devicetimeout",this.uniqueId)},b}(c),b.exports=d},{eventemitter3:14}],4:[function(a,b){var c,d,e,f,g,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),d=a("./FlintDevice"),g=a("./ssdp/SSDPManager"),f=a("./mdns/MDNSManager"),e=function(a){function b(){this.devices={},this.ssdpManager=null,this.mdnsManager=null,this._init()}var c;return i(b,a),c=1e4,b.prototype._init=function(){return this._initSSDP(),this._initmDns()},b.prototype._initSSDP=function(){return console.info("init SSDPManager"),this.ssdpManager=new g,this.ssdpManager.on("adddevice",function(a){return function(b){return a._addDevice(b)}}(this)),this.ssdpManager.on("removedevice",function(a){return function(b){return a._removeDevice(b)}}(this))},b.prototype._initmDns=function(){return console.info("init MDNSManager"),this.mdnsManager=new f,this.mdnsManager.on("adddevice",function(a){return function(b){return a._addDevice(b)}}(this)),this.mdnsManager.on("removedevice",function(a){return function(b){return a._removeDevice(b)}}(this))},b.prototype._addDevice=function(a){var b;return b=a.getUniqueId(),this.devices[b]?void 0:(console.log("found device: ",a.getName()),this.devices[b]=a,a.on("devicetimeout",function(a){return function(b){return a._removeDevice(b)}}(this)),this.emit("devicefound",a))},b.prototype._removeDevice=function(a){return this.devices[a]?(console.warn("gone device: ",this.devices[a].getName()),this.emit("devicegone",this.devices[a]),delete this.devices[a]):void 0},b.prototype.start=function(){var a,b;return null!=(a=this.ssdpManager)&&a.start(),null!=(b=this.mdnsManager)?b.start():void 0},b.prototype.stop=function(){var a,b;return null!=(a=this.ssdpManager)&&a.stop(),null!=(b=this.mdnsManager)?b.stop():void 0},b.prototype.getDeviceList=function(){var a,b,c,d;a=[],d=this.devices;for(c in d)b=d[c],a.push(b);return a},b}(c),b.exports=e},{"./FlintDevice":3,"./mdns/MDNSManager":6,"./ssdp/SSDPManager":8,eventemitter3:14}],5:[function(a){window.FlintDeviceScanner=a("./FlintDeviceScanner")},{"./FlintDeviceScanner":4}],6:[function(a,b){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),d=function(a){function b(){}return f(b,a),b.prototype.start=function(){return null},b.prototype.stop=function(){return null},b}(c),b.exports=d},{eventemitter3:14}],7:[function(a,b){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("../FlintDevice"),d=function(a){function b(a){b.__super__.constructor.apply(this,arguments),this.urlBase=a.urlBase,":9431"!==this.urlBase.slice(-5)&&(this.urlBase+=":9431"),this.host=this.urlBase.replace("http://",""),this.host=this.host.replace(":9431",""),this.friendlyName=a.friendlyName,this.uniqueId=a.udn}return f(b,a),b.prototype.getDeviceType=function(){return"ssdp"},b}(c),b.exports=d},{"../FlintDevice":3}],8:[function(a,b){var c,d,e,f,g,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),f=a("./SSDPResponder"),d=a("./SSDPDevice"),g=a("../../xhr/XhrGenerator"),e=function(a){function b(){this.devices={},this.ssdp=new f({st:"urn:dial-multiscreen-org:service:dial:1"}),this.ssdp.on("serviceFound",function(a){return function(b){return a.devices[b]?a.devices[b].triggerTimer?a.devices[b].triggerTimer():void 0:(a.devices[b]=b,a._fetchDeviceDesc(b))}}(this)),this.ssdp.on("serviceLost",function(a){return function(b){var c;return a.devices[b]?(c=a.devices[b],a.emit("removedevice",c),c.clear(),delete a.devices[b]):void 0}}(this))}return i(b,a),b.prototype.start=function(){return this.ssdp.start()},b.prototype.stop=function(){return this.ssdp.stop()},b.prototype._fetchDeviceDesc=function(a){var b;if(b=g.createXMLHttpRequest(),!b)throw"_fetchDeviceDesc: failed";return b.open("GET",a),b.onreadystatechange=function(c){return function(){return 4===b.readyState?c._parseDeviceDesc(b.responseText,a):void 0}}(this),b.send("")},b.prototype._parseDeviceDesc=function(a,b){var c,d,e,f,g,h;try{if(h=null,window.DOMParser?(e=new DOMParser,h=e.parseFromString(a,"text/xml")):(h=new ActiveXObject("Microsoft.XMLDOM"),h.async="false",h.loadXML(a)),f=null,g=h.querySelectorAll("URLBase"),g&&g.length>0&&(f=g[0].innerHTML),c=h.querySelectorAll("device"),c.length>0)return this._parseSingleDeviceDesc(c[0],f,b)}catch(i){return d=i,console.error(d)}},b.prototype._parseSingleDeviceDesc=function(a,b,c){var e,f,g,h,i,j;return f=a.querySelector("deviceType").innerHTML,j=a.querySelector("UDN").innerHTML,g=a.querySelector("friendlyName").innerHTML,h=a.querySelector("manufacturer").innerHTML,i=a.querySelector("modelName").innerHTML,e=new d({uniqueId:j,urlBase:b,deviceType:f,udn:j,friendlyName:g,manufacturer:h,modelName:i}),e.triggerTimer(),this.devices[c]=e,this.emit("adddevice",e)},b}(c),b.exports=e},{"../../xhr/XhrGenerator":13,"./SSDPDevice":7,"./SSDPResponder":9,eventemitter3:14}],9:[function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n={}.hasOwnProperty,o=function(a,b){function c(){this.constructor=a}for(var d in b)n.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),m=a("../../socket/SocketGenerator"),d=5e3,j=1900,f="239.255.255.250",g=10,h="M-SEARCH * HTTP/1.1\r\nHOST: "+f+":"+j+'\r\nMAN: "ssdp:discover"\r\nMX: '+g+"\r\nST: %SEARCH_TARGET%\r\n\r\n",k=/HTTP\/\d{1}\.\d{1} \d+ .*/,i=/^([^:]+):\s*(.*)$/,l="urn:dial-multiscreen-org:service:dial:1",e=function(a){function b(a){this.options=a,this.socket=null,this.searchTimerId=null,this.started=!1}return o(b,a),b.prototype._init=function(){return this.socket=m.createUdpSocket({loopback:!0,localPort:j}),this.socket.joinMulticastGroup(f),this.socket.onPacketReceived=function(a){return function(b){return a._onData(b)}}(this)},b.prototype.start=function(){if(this.started)throw"SSDPResponder already started";return this.started=!0,this._init(),this.searchTimerId=setInterval(function(a){return function(){return a._search()}}(this),d),this._search()},b.prototype._search=function(){var a,b;return a=h,b=a.replace("%SEARCH_TARGET%",l),this.socket.send(b,f,j)},b.prototype.stop=function(){return this.started?(this.started=!1,this.searchTimerId&&clearInterval(this.searchTimerId),this.socket.close()):void console.warn("SSDPResponder is not started")},b.prototype._onData=function(a){var b,c,d,e;if(d=a.toString().split("\r\n"),b=d.shift(),e=k.test(b)?"RESPONSE":b.split(" ")[0].toUpperCase(),c={},d.forEach(function(){return function(a){var b;return a.length&&(b=a.match(i))?c[b[1].toLowerCase()]=b[2]:void 0}}(this)),"M-SEARCH"===e);else{if("RESPONSE"===e)return this._onResponse(c);if("NOTIFY"===e)return this._onNotify(c)}},b.prototype._onResponse=function(a){return a.location&&this.options.st===a.st?this.emit("serviceFound",a.location):void 0},b.prototype._onNotify=function(a){if(a.location&&this.options.st===a.nt){if("ssdp:alive"===a.nts)return this.emit("serviceFound",a.location);if("ssdp:byebye"===a.nts)return this.emit("serviceLost",a.location)}},b}(c),b.exports=e},{"../../socket/SocketGenerator":10,eventemitter3:14}],10:[function(a,b){var c,d,e,f;e=a("../common/Platform"),c=a("./chrome_app/ChromeUdpSocket"),d=a("./ffos/FfosUdpSocket"),f=function(){function a(){}return a.createUdpSocket=function(a){var b,f;f=e.getPlatform();try{switch(f.browser){case"ffos":return new d(a);case"chrome_app":return new c(a);default:return null}}catch(g){return b=g,console.error("catch: ",b)}},a}(),b.exports=f},{"../common/Platform":2,"./chrome_app/ChromeUdpSocket":11,"./ffos/FfosUdpSocket":12}],11:[function(a,b){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=a("eventemitter3"),c=function(a){function b(a){this.options=a,this.localPort_=a.localPort,this.loopback_=a.loopback,this.socketId_=-1,this._init()}return f(b,a),b.ab2str=function(a){return String.fromCharCode.apply(null,new Uint8Array(a))},b.str2ab=function(a){var b,c,d,e;b=new ArrayBuffer(a.length),c=new Uint8Array(b);for(d in a)e=a[d],c[d]=a.charCodeAt(d);return b},b.prototype._init=function(){var a;return a={persistent:!1,name:"udpSocket",bufferSize:4096},chrome.sockets.udp.create({},function(a){return function(c){return a.socketId_=c.socketId,console.log("create UdpSocket: ",a.socketId_),chrome.sockets.udp.bind(a.socketId_,"0.0.0.0",a.localPort_,function(c){return console.log("bind UdpSocket: port=",a.localPort_,", result=",c),chrome.sockets.udp.onReceive.addListener(function(c){return a.socketId_===c.socketId?a._onMessage(b.ab2str(c.data)):void 0}),chrome.sockets.udp.onReceive.addListener(function(b){return a.socketId_===b.socketId?a._onError("error"):void 0}),a.emit("ready")})}}(this))},b.prototype._onMessage=function(a){return this.onPacketReceived?this.onPacketReceived(a):void 0},b.prototype._onError=function(a){return this.onerror?this.onerror(a):void 0},b.prototype.joinMulticastGroup=function(a){return-1===this.socketId_?this.once("ready",function(b){return function(){return chrome.sockets.udp.joinGroup(b.socketId_,a,function(b){return console.log("joinGroup UdpSocket: addr=",a,", result=",b)})}}(this)):chrome.sockets.udp.joinGroup(this.socketId_,a,function(){return function(b){return console.log("joinGroup UdpSocket: addr=",a,", result=",b)}}(this))},b.prototype.send=function(a,c,d){var e;if(this.socketId_)return e=b.str2ab(a),chrome.sockets.udp.send(this.socketId_,e,c,d,function(){return function(a){return a.resultCode<0?console.error("UdpSocket: send error!!!"):console.log("UdpSocket: send success, ",a.bytesSent)}}(this))},b.prototype.close=function(){return this.socketId_?chrome.sockets.udp.close(this.socketId_,function(a){return function(){return console.log("socket closed! ",a.socketId_)}}(this)):void 0},b}(d),b.exports=c},{eventemitter3:14}],12:[function(a,b){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),d=function(a){function b(a){this.options=a,this.localPort_=a.localPort,this.loopback_=a.loopback,this.socket_=new UDPSocket(a),this.socket.onmessage=function(){return function(a){var b;return b=String.fromCharCode.apply(null,new Uint8Array(a.data)),_onMessage(b)}}(this)}return f(b,a),b.prototype._onMessage=function(a){return this.onPacketReceived?this.onPacketReceived(a):void 0},b.prototype.joinMulticastGroup=function(a){var b;return null!=(b=this.socket)?b.joinMulticastGroup(a):void 0},b.prototype.send=function(a,b,c){var d;return null!=(d=this.socket)?d.send(a,b,c):void 0},b.prototype.close=function(){var a;return null!=(a=this.socket)?a.close():void 0},b}(c),b.exports=d},{eventemitter3:14}],13:[function(a,b){var c,d;c=a("../common/Platform"),d=function(){function a(){}return a.createXMLHttpRequest=function(){var a,b;b=c.getPlatform();try{switch(b.browser){case"ffos":return new XMLHttpRequest({mozSystem:!0});default:return new XMLHttpRequest}}catch(d){return a=d,console.error("catch: ",a)}},a}(),b.exports=d},{"../common/Platform":2}],14:[function(a,b){"use strict";function c(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function d(){}d.prototype._events=void 0,d.prototype.listeners=function(a){if(!this._events||!this._events[a])return[];if(this._events[a].fn)return[this._events[a].fn];for(var b=0,c=this._events[a].length,d=new Array(c);c>b;b++)d[b]=this._events[a][b].fn;return d},d.prototype.emit=function(a,b,c,d,e,f){if(!this._events||!this._events[a])return!1;var g,h,i=this._events[a],j=arguments.length;if("function"==typeof i.fn){switch(i.once&&this.removeListener(a,i.fn,!0),j){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,b),!0;case 3:return i.fn.call(i.context,b,c),!0;case 4:return i.fn.call(i.context,b,c,d),!0;case 5:return i.fn.call(i.context,b,c,d,e),!0;case 6:return i.fn.call(i.context,b,c,d,e,f),!0}for(h=1,g=new Array(j-1);j>h;h++)g[h-1]=arguments[h];i.fn.apply(i.context,g)}else{var k,l=i.length;for(h=0;l>h;h++)switch(i[h].once&&this.removeListener(a,i[h].fn,!0),j){case 1:i[h].fn.call(i[h].context);break;case 2:i[h].fn.call(i[h].context,b);break;case 3:i[h].fn.call(i[h].context,b,c);break;default:if(!g)for(k=1,g=new Array(j-1);j>k;k++)g[k-1]=arguments[k];i[h].fn.apply(i[h].context,g)}}return!0},d.prototype.on=function(a,b,d){var e=new c(b,d||this);return this._events||(this._events={}),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],e]:this._events[a].push(e):this._events[a]=e,this},d.prototype.once=function(a,b,d){var e=new c(b,d||this,!0);return this._events||(this._events={}),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],e]:this._events[a].push(e):this._events[a]=e,this},d.prototype.removeListener=function(a,b,c){if(!this._events||!this._events[a])return this;var d=this._events[a],e=[];if(b&&(d.fn&&(d.fn!==b||c&&!d.once)&&e.push(d),!d.fn))for(var f=0,g=d.length;g>f;f++)(d[f].fn!==b||c&&!d[f].once)&&e.push(d[f]);return e.length?this._events[a]=1===e.length?e[0]:e:delete this._events[a],this},d.prototype.removeAllListeners=function(a){return this._events?(a?delete this._events[a]:this._events={},this):this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prototype.setMaxListeners=function(){return this},d.EventEmitter=d,d.EventEmitter2=d,d.EventEmitter3=d,b.exports=d},{}]},{},[5]);